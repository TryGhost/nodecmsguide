---
interface Props {
  title: string;
  slug: string;
  openSource: boolean;
  type: string;
  generators: string[];
  description: string;
  stars?: number;
  starsPrevious?: number;
  forks?: number;
  forksPrevious?: number;
  issues?: number;
  issuesPrevious?: number;
  images?: { path: string }[];
  dataAgeInDays?: number;
}

const {
  title,
  slug,
  openSource,
  type,
  generators = [],
  description,
  stars,
  starsPrevious = 0,
  forks,
  forksPrevious = 0,
  issues,
  issuesPrevious = 0,
  images,
  dataAgeInDays = 0,
} = Astro.props;

function formatNumber(num: number | undefined): string {
  if (typeof num !== 'number') return 'N/A';
  return num.toLocaleString();
}

function getChange(current: number | undefined, previous: number): string {
  if (typeof current !== 'number') return '';
  const diff = current - previous;
  if (diff === 0) return '--';
  return diff > 0 ? `+${diff}` : `${diff}`;
}

const starsChange = getChange(stars, starsPrevious);
const forksChange = getChange(forks, forksPrevious);
const issuesChange = getChange(issues, issuesPrevious);

const hasStats = typeof stars === 'number' || typeof forks === 'number' || typeof issues === 'number';
---

<a href={`/projects/${slug}`} class="card">
  {openSource && <div class="tag">open source</div>}
  {images && images.length > 0 && (
    <img alt="" class="photos-inside" src="/images/photos.svg" />
  )}
  <h4 class:list={['title', { 'title-small': title.length > 14 }]}>{title}</h4>

  {hasStats && (
    <div class="open-source-stats">
      <div class:list={['stat-item', { disabled: typeof stars !== 'number' }]} title="GitHub stars">
        <span class="stat-icon">
          <svg viewBox="0 0 16 16" width="18" height="18" fill="currentColor">
            <path d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25z"></path>
          </svg>
        </span>
        {typeof stars === 'number' ? (
          <div>
            <strong>{formatNumber(stars)}</strong>
            {dataAgeInDays >= 1 && (
              <span class:list={['change', { up: Number(starsChange) > 0, down: Number(starsChange) < 0 }]} title={`Stars in the last ${dataAgeInDays} day${dataAgeInDays === 1 ? '' : 's'}`}>
                {starsChange}
              </span>
            )}
          </div>
        ) : (
          <div>N/A</div>
        )}
      </div>

      <div class:list={['stat-item', { disabled: typeof issues !== 'number' }]} title="GitHub open issues">
        <span class="stat-icon">
          <svg viewBox="0 0 16 16" width="18" height="18" fill="currentColor">
            <path d="M8 9.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path>
            <path fill-rule="evenodd" d="M8 0a8 8 0 100 16A8 8 0 008 0zM1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0z"></path>
          </svg>
        </span>
        {typeof issues === 'number' ? (
          <div>
            <strong>{formatNumber(issues)}</strong>
            {dataAgeInDays >= 1 && (
              <span class="change" title={`Issues in the last ${dataAgeInDays} day${dataAgeInDays === 1 ? '' : 's'}`}>
                {issuesChange}
              </span>
            )}
          </div>
        ) : (
          <div>N/A</div>
        )}
      </div>

      <div class:list={['stat-item', { disabled: typeof forks !== 'number' }]} title="GitHub forks">
        <span class="stat-icon">
          <svg viewBox="0 0 16 16" width="18" height="18" fill="currentColor">
            <path fill-rule="evenodd" d="M5 3.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.122a2.25 2.25 0 10-1.5 0v.878A2.25 2.25 0 005.75 8.5h1.5v2.128a2.251 2.251 0 101.5 0V8.5h1.5a2.25 2.25 0 002.25-2.25v-.878a2.25 2.25 0 10-1.5 0v.878a.75.75 0 01-.75.75h-4.5A.75.75 0 015 6.25v-.878zm3.75 7.378a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm3-8.75a.75.75 0 100-1.5.75.75 0 000 1.5z"></path>
          </svg>
        </span>
        {typeof forks === 'number' ? (
          <div>
            <strong>{formatNumber(forks)}</strong>
            {dataAgeInDays >= 1 && (
              <span class:list={['change', { up: Number(forksChange) > 0, down: Number(forksChange) < 0 }]} title={`Forks in the last ${dataAgeInDays} day${dataAgeInDays === 1 ? '' : 's'}`}>
                {forksChange}
              </span>
            )}
          </div>
        ) : (
          <div>N/A</div>
        )}
      </div>
    </div>
  )}

  <div class="description">{description}</div>

  <div class="data-point">
    <h6 class="data-point-title">Type:</h6>
    <p class="type">{type || 'Unknown'}</p>
  </div>

  <div class="data-point">
    <h6 class="data-point-title">Supported Site Generators:</h6>
    <p>{generators.join(', ')}</p>
  </div>
</a>

<style>
  .open-source-stats {
    border-top: 1px solid #eee;
    border-bottom: 1px solid #eee;
    background: #fcfcfc;
    padding: 18px;
    margin: 16px -18px 0;
    display: flex;
    justify-content: space-between;
  }

  .stat-item {
    font-size: 15px;
    text-align: center;
    color: #313d3e;
    width: 25%;
  }

  .stat-item svg {
    fill: #313d3e;
  }

  .stat-item.disabled {
    color: #bbb;
  }

  .stat-item.disabled svg {
    fill: #bbb;
  }

  .stat-icon {
    display: inline-block;
    width: 18px;
    height: 18px;
  }

  .change {
    font-size: 14px;
    display: block;
  }

  .change.up {
    color: #31bb47;
  }

  .change.down {
    color: #c91b1b;
  }

  .data-point {
    margin-top: 8px;
  }

  .data-point p {
    margin-top: 0;
  }

  .data-point-title {
    display: inline;
    font-size: 14px;
    font-weight: 600;
    margin-right: 4px;
  }

  .title-small {
    font-size: 24px;
    padding-top: 7px !important;
    padding-bottom: 10px !important;
  }
</style>
